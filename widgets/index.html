<!doctype html>
<html>
<head>
  <title>Widgets Demo</title>
</head>
<body>
  <p>See javascript console for output</p>
  <script src="/browser-buffer.js"></script>
  <script src="/brozula.js"></script>
  <script>
    function load(url, callback) {
      var xhr = new XMLHttpRequest();
      xhr.open('GET', url, true);
      xhr.responseType = 'arraybuffer';

      xhr.onload = function(e) {
        var buffer = Buffer(this.response);
        var program = brozula.compile(buffer);
        var fn = new Function(program);
        callback(null, fn);
      };
      xhr.send();
    }

    load("dombuilder.luax", function (err, fn) {
      if (err) throw err;
      window.domBuilder = fn();
      load("app.luax", function (err, fn) {
        if (err) throw err;
        fn();
      });
    });

  </script>
</body>
</head>
</html>